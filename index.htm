<!DOCTYPE html> <html> <head> <title>Browser-based LUSTRE Simulator</title> <style>body{font-family:sans-serif;}h1{text-align:center;}#code{width:100%;height:20em;resize:vertical;}#code.error{background:#fee;}#results{text-align:center;border-collapse:collapse;margin:0.5em 0;}#results td, #results th{border:solid black 1px;}#results .valtrue{background:#7F7;}#results .valfalse{background:#f77;}#results .valnull{background:#eee;}#results .local{color:#777;}#results .header{background:#ccc;}#results input{width:5em;}#results td{width:5em;}#error{margin:1em 0;}#error{color:red;font-weight:bold;}fieldset{margin-top:1em;}</style> <meta charset="utf-8"> </head> <body> <h1>Browser-based LUSTRE Simulator</h1> <fieldset> <legend>LUSTRE Code</legend> <textarea id="code">-- simple counter node 
node counter ()  
    returns (c: int);  
let  
    c = 1 fby c + 1;  
tel 
 
-- node that counts every second cycle 
node slowcounter()  
    returns (c: int);  
var a: bool;  
let  
    a = true fby not a;  
    c = current(counter() when a);  
tel</textarea> </fieldset> <fieldset> <legend>Node</legend> <label for="node">Node to execute:</label> <select id="node"></select> </fieldset> <fieldset> <legend>Results</legend> <button id="stepNode">Step</button> <button id="resetNode">Reset</button> <label><input type="checkbox" id="autostep">Auto-step at 1 Hz</label> <table id="results"> </table> <div id="error"></div> </fieldset> <script>!function(r){"use strict";function t(r,n,e,u){this.message=r,this.expected=n,this.found=e,this.location=u,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}function n(r,n){function e(){return r.substring(uu,eu)}function u(){return f(uu,eu)}function o(r,t){return{type:"literal",text:r,ignoreCase:t}}function c(r,t,n){return{type:"class",parts:r,inverted:t,ignoreCase:n}}function a(r){return{type:"other",description:r}}function i(t){var n,e=ou[t];if(e)return e;for(n=t-1;!ou[n];)n--;for(e=ou[n],e={line:e.line,column:e.column};n<t;)10===r.charCodeAt(n)?(e.line++,e.column=1):e.column++,n++;return ou[t]=e,e}function f(r,t){var n=i(r),e=i(t);return{start:{offset:r,line:n.line,column:n.column},end:{offset:t,line:e.line,column:e.column}}}function s(r){eu<cu||(eu>cu&&(cu=eu,au=[]),au.push(r))}function h(r,n,e){return new t(t.buildMessage(r,n),r,n,e)}function l(){var r,t,n,e,u,o;if(r=eu,(t=Ar())!==_r){if(n=[],e=eu,u=p(),u!==_r?(o=Ar(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r),e!==_r)for(;e!==_r;)n.push(e),e=eu,u=p(),u!==_r?(o=Ar(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r);else n=_r;n!==_r?(uu=r,t=Mr(n),r=t):(eu=r,r=_r)}else eu=r,r=_r;return r}function p(){var r,t;return r=eu,t=Z(),t!==_r&&(uu=r,t=Tr(t)),r=t,r===_r&&(r=eu,t=d(),t!==_r&&(uu=r,t=qr(t)),(r=t)===_r&&(r=eu,t=j(),t!==_r&&(uu=r,t=Br(t)),r=t)),r}function d(){var r,t,n,e;return r=eu,t=v(),t!==_r?(n=Ar(),n!==_r?(e=y(),e===_r&&(e=null),e!==_r?(uu=r,t=Ir(t,e),r=t):(eu=r,r=_r)):(eu=r,r=_r)):(eu=r,r=_r),r}function v(){var t,n,e,u,o,c,a,i,f,h,l,p,d,v,g,C,b,y,m,x,F,S;return t=eu,r.substr(eu,4)===Nr?(n=Nr,eu+=4):(n=_r,0===iu&&s(Or)),n===_r&&(r.substr(eu,8)===Ur?(n=Ur,eu+=8):(n=_r,0===iu&&s(Dr))),n!==_r?(e=Ar(),e!==_r?(u=w(),u!==_r?(o=Ar(),o!==_r?(40===r.charCodeAt(eu)?(c=Gr,eu++):(c=_r,0===iu&&s(Hr)),c!==_r?(a=Ar(),a!==_r?(i=A(),i===_r&&(i=null),i!==_r?(f=Ar(),f!==_r?(41===r.charCodeAt(eu)?(h=Jr,eu++):(h=_r,0===iu&&s(Kr)),h!==_r?(l=Ar(),l!==_r?(r.substr(eu,7)===Lr?(p=Lr,eu+=7):(p=_r,0===iu&&s(Pr)),p!==_r?(d=Ar(),d!==_r?(40===r.charCodeAt(eu)?(v=Gr,eu++):(v=_r,0===iu&&s(Hr)),v!==_r?(g=Ar(),g!==_r?(C=A(),C===_r&&(C=null),C!==_r?(b=Ar(),b!==_r?(41===r.charCodeAt(eu)?(y=Jr,eu++):(y=_r,0===iu&&s(Kr)),y!==_r?(m=Ar(),m!==_r?(x=pr(),x!==_r?(F=Ar(),F!==_r?(59===r.charCodeAt(eu)?(S=Qr,eu++):(S=_r,0===iu&&s(Vr)),S!==_r?(uu=t,n=Wr(n,u,i,C),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function A(){var t,n,e,u,o,c,a,i;if(t=eu,(n=g())!==_r){for(e=[],u=eu,o=Ar(),o!==_r?(59===r.charCodeAt(eu)?(c=Qr,eu++):(c=_r,0===iu&&s(Vr)),c!==_r?(a=Ar(),a!==_r?(i=g(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=Ar(),o!==_r?(59===r.charCodeAt(eu)?(c=Qr,eu++):(c=_r,0===iu&&s(Vr)),c!==_r?(a=Ar(),a!==_r?(i=g(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(uu=t,n=Xr(n,e),t=n):(eu=t,t=_r)}else eu=t,t=_r;return t}function g(){var t,n,e,u,o,c,a,i,f;return t=eu,n=_(),n!==_r?(e=Ar(),e!==_r?(58===r.charCodeAt(eu)?(u=Yr,eu++):(u=_r,0===iu&&s($r)),u!==_r?(o=Ar(),o!==_r?(c=E(),c!==_r?(a=eu,i=Ar(),i!==_r?(f=C(),f!==_r?(i=[i,f],a=i):(eu=a,a=_r)):(eu=a,a=_r),a===_r&&(a=null),a!==_r?(i=Ar(),i!==_r?(f=pr(),f!==_r?(uu=t,n=rt(n,c,a),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function C(){var t,n,e,u;return t=eu,r.substr(eu,4)===tt?(n=tt,eu+=4):(n=_r,0===iu&&s(nt)),n!==_r?(e=Ar(),e!==_r?(u=b(),u!==_r?(uu=t,n=et(u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function b(){var r,t;return r=eu,t=w(),t!==_r&&(uu=r,t=ut(t)),r=t}function y(){var t,n,e,u,o,c,a,i;for(t=eu,n=[],e=eu,u=m(),u!==_r?(o=Ar(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r);e!==_r;)n.push(e),e=eu,u=m(),u!==_r?(o=Ar(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r);return n!==_r?(r.substr(eu,3)===ot?(e=ot,eu+=3):(e=_r,0===iu&&s(ct)),e!==_r?(u=Ar(),u!==_r?(o=M(),o!==_r?(c=Ar(),c!==_r?(r.substr(eu,3)===at?(a=at,eu+=3):(a=_r,0===iu&&s(it)),a!==_r?(59===r.charCodeAt(eu)?(i=Qr,eu++):(i=_r,0===iu&&s(Vr)),i===_r&&(i=null),i!==_r?(uu=t,n=ft(n,o),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function m(){var r,t;return r=eu,t=x(),t!==_r&&(uu=r,t=st(t)),r=t,r===_r&&(r=eu,t=F(),t!==_r&&(uu=r,t=ht(t)),r=t),r}function x(){var t,n,e,u,o,c;return t=eu,r.substr(eu,3)===lt?(n=lt,eu+=3):(n=_r,0===iu&&s(pt)),n!==_r?(e=Ar(),e!==_r?(u=A(),u!==_r?(o=Ar(),o!==_r?(59===r.charCodeAt(eu)?(c=Qr,eu++):(c=_r,0===iu&&s(Vr)),c!==_r?(uu=t,n=dt(u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function F(){var t,n,e,u;if(t=eu,r.substr(eu,5)===vt?(n=vt,eu+=5):(n=_r,0===iu&&s(At)),n!==_r)if(Ar()!==_r){if(e=[],(u=S())!==_r)for(;u!==_r;)e.push(u),u=S();else e=_r;e!==_r?(uu=t,n=gt(e),t=n):(eu=t,t=_r)}else eu=t,t=_r;else eu=t,t=_r;return t}function S(){var t,n,e,u,o,c,a,i,f;return t=eu,n=dr(),n!==_r?(e=Ar(),e!==_r?(u=eu,58===r.charCodeAt(eu)?(o=Yr,eu++):(o=_r,0===iu&&s($r)),o!==_r?(c=Ar(),c!==_r?(a=E(),a!==_r?(i=Ar(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r),u===_r&&(u=null),u!==_r?(61===r.charCodeAt(eu)?(o=Ct,eu++):(o=_r,0===iu&&s(bt)),o!==_r?(c=Ar(),c!==_r?(a=D(),a!==_r?(i=Ar(),i!==_r?(59===r.charCodeAt(eu)?(f=Qr,eu++):(f=_r,0===iu&&s(Vr)),f!==_r?(uu=t,n=yt(n,u,a),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function w(){var t,n,e,u;return t=eu,n=dr(),n!==_r?(r.substr(eu,2)===mt?(e=mt,eu+=2):(e=_r,0===iu&&s(xt)),e!==_r?(u=dr(),u!==_r?(uu=t,n=Ft(n,u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,n=dr(),n!==_r&&(uu=t,n=St(n)),t=n),t}function E(){var r,t;return r=eu,t=z(),t!==_r&&(uu=r,t=wt(t)),r=t,r===_r&&(r=eu,t=dr(),t!==_r&&(uu=r,t=Et(t)),r=t),r}function z(){var t,n,e,u,o,c,a,i;return t=eu,r.substr(eu,4)===Rt?(n=Rt,eu+=4):(n=_r,0===iu&&s(_t)),n!==_r?(e=Ar(),e!==_r?(123===r.charCodeAt(eu)?(u=jt,eu++):(u=_r,0===iu&&s(kt)),u!==_r?(o=Ar(),o!==_r?(c=_(),c!==_r?(a=Ar(),a!==_r?(125===r.charCodeAt(eu)?(i=Mt,eu++):(i=_r,0===iu&&s(Tt)),i!==_r?(uu=t,n=qt(c),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function Z(){var t,n,e,u,o,c;if(t=eu,r.substr(eu,5)===vt?(n=vt,eu+=5):(n=_r,0===iu&&s(At)),n!==_r)if(Ar()!==_r){if(e=[],u=eu,o=R(),o!==_r?(c=Ar(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r),u!==_r)for(;u!==_r;)e.push(u),u=eu,o=R(),o!==_r?(c=Ar(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r);else e=_r;e!==_r?(uu=t,n=Bt(e),t=n):(eu=t,t=_r)}else eu=t,t=_r;else eu=t,t=_r;return t}function R(){var t,n,e,u,o,c,a,i,f,h,l,p,d;return t=eu,n=_(),n!==_r?(e=Ar(),e!==_r?(58===r.charCodeAt(eu)?(u=Yr,eu++):(u=_r,0===iu&&s($r)),u!==_r?(o=Ar(),o!==_r?(c=E(),c!==_r?(a=Ar(),a!==_r?(i=pr(),i!==_r?(f=Ar(),f!==_r?(59===r.charCodeAt(eu)?(h=Qr,eu++):(h=_r,0===iu&&s(Vr)),h!==_r?(uu=t,n=It(n,c),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,n=dr(),n!==_r?(e=Ar(),e!==_r?(61===r.charCodeAt(eu)?(u=Ct,eu++):(u=_r,0===iu&&s(bt)),u!==_r?(o=Ar(),o!==_r?(c=D(),c!==_r?(a=Ar(),a!==_r?(i=pr(),i!==_r?(f=Ar(),f!==_r?(59===r.charCodeAt(eu)?(h=Qr,eu++):(h=_r,0===iu&&s(Vr)),h!==_r?(uu=t,n=Nt(n,c),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,n=dr(),n!==_r?(e=Ar(),e!==_r?(58===r.charCodeAt(eu)?(u=Yr,eu++):(u=_r,0===iu&&s($r)),u!==_r?(o=Ar(),o!==_r?(c=E(),c!==_r?(a=Ar(),a!==_r?(61===r.charCodeAt(eu)?(i=Ct,eu++):(i=_r,0===iu&&s(bt)),i!==_r?(f=Ar(),f!==_r?(h=D(),h!==_r?(l=pr(),l!==_r?(p=Ar(),p!==_r?(59===r.charCodeAt(eu)?(d=Qr,eu++):(d=_r,0===iu&&s(Vr)),d!==_r?(uu=t,n=Ot(n,c,h),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r))),t}function _(){var t,n,e,u,o,c,a,i;if(t=eu,(n=dr())!==_r){for(e=[],u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=dr(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=dr(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(uu=t,n=Ut(n,e),t=n):(eu=t,t=_r)}else eu=t,t=_r;return t}function j(){var t,n,e,u,o,c,a;if(t=eu,r.substr(eu,4)===Dt?(n=Dt,eu+=4):(n=_r,0===iu&&s(Gt)),n!==_r)if(Ar()!==_r){if(e=[],u=eu,o=k(),o!==_r?(c=Ar(),c!==_r?(59===r.charCodeAt(eu)?(a=Qr,eu++):(a=_r,0===iu&&s(Vr)),a!==_r?(o=[o,c,a],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r),u!==_r)for(;u!==_r;)e.push(u),u=eu,o=k(),o!==_r?(c=Ar(),c!==_r?(59===r.charCodeAt(eu)?(a=Qr,eu++):(a=_r,0===iu&&s(Vr)),a!==_r?(o=[o,c,a],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);else e=_r;e!==_r?(uu=t,n=Ht(e),t=n):(eu=t,t=_r)}else eu=t,t=_r;else eu=t,t=_r;return t}function k(){var t,n,e,u,o,c;return t=eu,n=dr(),n!==_r?(e=Ar(),e!==_r?(61===r.charCodeAt(eu)?(u=Ct,eu++):(u=_r,0===iu&&s(bt)),u!==_r?(o=Ar(),o!==_r?(c=E(),c!==_r?(uu=t,n=Jt(n,c),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function M(){var r,t,n,e,u,o;if(r=eu,(t=T())!==_r){for(n=[],e=eu,u=Ar(),u!==_r?(o=T(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r);e!==_r;)n.push(e),e=eu,u=Ar(),u!==_r?(o=T(),o!==_r?(u=[u,o],e=u):(eu=e,e=_r)):(eu=e,e=_r);n!==_r?(uu=r,t=Kt(t,n),r=t):(eu=r,r=_r)}else eu=r,r=_r;return r}function T(){var r,t;return r=eu,t=q(),t!==_r&&(uu=r,t=Lt(t)),r=t,r===_r&&(r=eu,t=O(),t!==_r&&(uu=r,t=Pt(t)),r=t),r}function q(){var t,n,e,u,o,c,a,i,f,h;return t=eu,n=B(),n!==_r?(e=Ar(),e!==_r?(61===r.charCodeAt(eu)?(u=Ct,eu++):(u=_r,0===iu&&s(bt)),u!==_r?(o=Ar(),o!==_r?(c=D(),c!==_r?(a=Ar(),a!==_r?(i=pr(),i!==_r?(f=Ar(),f!==_r?(59===r.charCodeAt(eu)?(h=Qr,eu++):(h=_r,0===iu&&s(Vr)),h!==_r?(uu=t,n=Qt(n,c),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function B(){var t,n,e,u,o,c;return t=eu,40===r.charCodeAt(eu)?(n=Gr,eu++):(n=_r,0===iu&&s(Hr)),n!==_r?(e=Ar(),e!==_r?(u=I(),u!==_r?(o=Ar(),o!==_r?(41===r.charCodeAt(eu)?(c=Jr,eu++):(c=_r,0===iu&&s(Kr)),c!==_r?(uu=t,n=Vt(u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,n=I(),n!==_r&&(uu=t,n=Vt(n)),t=n),t}function I(){var t,n,e,u,o,c,a,i;if(t=eu,(n=N())!==_r){for(e=[],u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=N(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=N(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(uu=t,n=Wt(n,e),t=n):(eu=t,t=_r)}else eu=t,t=_r;return t}function N(){var r,t;return r=eu,t=w(),t!==_r&&(uu=r,t=Xt(t)),r=t}function O(){var t,n,e,u,o,c,a,i;return t=eu,r.substr(eu,6)===Yt?(n=Yt,eu+=6):(n=_r,0===iu&&s($t)),n!==_r?(e=Ar(),e!==_r?(u=D(),u!==_r?(o=Ar(),o!==_r?(c=pr(),c!==_r?(a=Ar(),a!==_r?(59===r.charCodeAt(eu)?(i=Qr,eu++):(i=_r,0===iu&&s(Vr)),i!==_r?(uu=t,n=rn(u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function U(){var t,n,e,u;return r.substr(eu,2)===tn?(t=tn,eu+=2):(t=_r,0===iu&&s(nn)),t===_r&&(t=eu,r.substr(eu,3)===en?(n=en,eu+=3):(n=_r,0===iu&&s(un)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=an(),t=n):(eu=t,t=_r)):(eu=t,t=_r)),t}function D(){var r,t,n,e,u,o,c;return r=eu,t=H(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=U(),u!==_r?(o=Ar(),o!==_r?(c=D(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function G(){var t;return r.substr(eu,2)===sn?(t=sn,eu+=2):(t=_r,0===iu&&s(hn)),t}function H(){var r,t,n,e,u,o,c;return r=eu,t=K(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=G(),u!==_r?(o=Ar(),o!==_r?(c=H(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function J(){var t,n,e,u;return t=eu,r.substr(eu,2)===ln?(n=ln,eu+=2):(n=_r,0===iu&&s(pn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=dn(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,r.substr(eu,3)===vn?(n=vn,eu+=3):(n=_r,0===iu&&s(An)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=gn(),t=n):(eu=t,t=_r)):(eu=t,t=_r)),t}function K(){var r,t,n,e,u,o,c;return r=eu,t=P(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=J(),u!==_r?(o=Ar(),o!==_r?(c=K(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function L(){var t,n,e,u;return t=eu,r.substr(eu,3)===Cn?(n=Cn,eu+=3):(n=_r,0===iu&&s(bn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=yn(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t}function P(){var r,t,n,e,u,o,c;return r=eu,t=V(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=L(),u!==_r?(o=Ar(),o!==_r?(c=P(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function Q(){var t;return r.substr(eu,2)===mn?(t=mn,eu+=2):(t=_r,0===iu&&s(xn)),t===_r&&(r.substr(eu,2)===Fn?(t=Fn,eu+=2):(t=_r,0===iu&&s(Sn)),t===_r&&(60===r.charCodeAt(eu)?(t=wn,eu++):(t=_r,0===iu&&s(En)),t===_r&&(61===r.charCodeAt(eu)?(t=Ct,eu++):(t=_r,0===iu&&s(bt)),t===_r&&(r.substr(eu,2)===zn?(t=zn,eu+=2):(t=_r,0===iu&&s(Zn)),t===_r&&(62===r.charCodeAt(eu)?(t=Rn,eu++):(t=_r,0===iu&&s(_n))))))),t}function V(){var r,t,n,e,u,o,c;return r=eu,t=X(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=Q(),u!==_r?(o=Ar(),o!==_r?(c=V(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function W(){var t,n,e,u;return t=eu,r.substr(eu,3)===jn?(n=jn,eu+=3):(n=_r,0===iu&&s(kn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=Mn(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t}function X(){var r,t,n,e;return r=eu,t=W(),t!==_r?(n=Ar(),n!==_r?(e=X(),e!==_r?(uu=r,t=Tn(t,e),r=t):(eu=r,r=_r)):(eu=r,r=_r)):(eu=r,r=_r),r===_r&&(r=eu,t=$(),t!==_r&&(uu=r,t=Vt(t)),r=t),r}function Y(){var t;return 43===r.charCodeAt(eu)?(t=qn,eu++):(t=_r,0===iu&&s(Bn)),t===_r&&(45===r.charCodeAt(eu)?(t=In,eu++):(t=_r,0===iu&&s(Nn))),t}function $(){var r,t,n,e,u,o,c,a;if(r=eu,(t=tr())!==_r){for(n=[],e=eu,u=Ar(),u!==_r?(o=Y(),o!==_r?(c=Ar(),c!==_r?(a=tr(),a!==_r?(u=[u,o,c,a],e=u):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r);e!==_r;)n.push(e),e=eu,u=Ar(),u!==_r?(o=Y(),o!==_r?(c=Ar(),c!==_r?(a=tr(),a!==_r?(u=[u,o,c,a],e=u):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r);n!==_r?(uu=r,t=On(t,n),r=t):(eu=r,r=_r)}else eu=r,r=_r;return r}function rr(){var t,n,e,u;return 42===r.charCodeAt(eu)?(t=Un,eu++):(t=_r,0===iu&&s(Dn)),t===_r&&(47===r.charCodeAt(eu)?(t=Gn,eu++):(t=_r,0===iu&&s(Hn)),t===_r&&(t=eu,r.substr(eu,3)===Jn?(n=Jn,eu+=3):(n=_r,0===iu&&s(Kn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=Ln(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,r.substr(eu,3)===Pn?(n=Pn,eu+=3):(n=_r,0===iu&&s(Qn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=Vn(),t=n):(eu=t,t=_r)):(eu=t,t=_r)))),t}function tr(){var r,t,n,e,u,o,c,a;if(r=eu,(t=er())!==_r){for(n=[],e=eu,u=Ar(),u!==_r?(o=rr(),o!==_r?(c=Ar(),c!==_r?(a=er(),a!==_r?(u=[u,o,c,a],e=u):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r);e!==_r;)n.push(e),e=eu,u=Ar(),u!==_r?(o=rr(),o!==_r?(c=Ar(),c!==_r?(a=er(),a!==_r?(u=[u,o,c,a],e=u):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r)):(eu=e,e=_r);n!==_r?(uu=r,t=On(t,n),r=t):(eu=r,r=_r)}else eu=r,r=_r;return r}function nr(){var t;return r.substr(eu,4)===tt?(t=tt,eu+=4):(t=_r,0===iu&&s(nt)),t}function er(){var r,t,n,e,u,o,c;return r=eu,t=or(),t!==_r?(n=eu,e=Ar(),e!==_r?(u=nr(),u!==_r?(o=Ar(),o!==_r?(c=er(),c!==_r?(e=[e,u,o,c],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r),n===_r&&(n=null),n!==_r?(uu=r,t=fn(t,n),r=t):(eu=r,r=_r)):(eu=r,r=_r),r}function ur(){var t,n,e,u;return 45===r.charCodeAt(eu)?(t=In,eu++):(t=_r,0===iu&&s(Nn)),t===_r&&(t=eu,r.substr(eu,7)===Wn?(n=Wn,eu+=7):(n=_r,0===iu&&s(Xn)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=Yn(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,r.substr(eu,3)===$n?(n=$n,eu+=3):(n=_r,0===iu&&s(re)),n!==_r?(e=eu,iu++,on.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(cn)),iu--,u!==_r?(eu=e,e=void 0):e=_r,e!==_r?(uu=t,n=te(),t=n):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(35===r.charCodeAt(eu)?(t=ne,eu++):(t=_r,0===iu&&s(ee))))),t}function or(){var r,t,n,e;return r=eu,t=ur(),t!==_r?(n=Ar(),n!==_r?(e=or(),e!==_r?(uu=r,t=Tn(t,e),r=t):(eu=r,r=_r)):(eu=r,r=_r)):(eu=r,r=_r),r===_r&&(r=eu,t=cr(),t!==_r&&(uu=r,t=ue(t)),r=t),r}function cr(){var t,n,e,u,o,c,a,i,f,h,l,p;return t=eu,n=fr(),n!==_r&&(uu=t,n=oe(n)),t=n,t===_r&&(t=eu,n=ir(),n!==_r&&(uu=t,n=ce(n)),(t=n)===_r&&(t=eu,n=w(),n!==_r&&(uu=t,n=Xt(n)),(t=n)===_r&&(t=eu,40===r.charCodeAt(eu)?(n=Gr,eu++):(n=_r,0===iu&&s(Hr)),n!==_r?(e=Ar(),e!==_r?(u=ar(),u!==_r?(o=Ar(),o!==_r?(41===r.charCodeAt(eu)?(c=Jr,eu++):(c=_r,0===iu&&s(Kr)),c!==_r?(uu=t,n=ae(u),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t===_r&&(t=eu,r.substr(eu,2)===ie?(n=ie,eu+=2):(n=_r,0===iu&&s(fe)),n!==_r?(e=Ar(),e!==_r?(u=D(),u!==_r?(o=Ar(),o!==_r?(r.substr(eu,4)===se?(c=se,eu+=4):(c=_r,0===iu&&s(he)),c!==_r?(a=Ar(),a!==_r?(i=D(),i!==_r?(f=Ar(),f!==_r?(r.substr(eu,4)===le?(h=le,eu+=4):(h=_r,0===iu&&s(pe)),h!==_r?(l=Ar(),l!==_r?(p=D(),p!==_r?(uu=t,n=de(u,i,p),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r))))),t}function ar(){var t,n,e,u,o,c,a,i;if(t=eu,(n=D())!==_r){for(e=[],u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=D(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=Ar(),o!==_r?(44===r.charCodeAt(eu)?(c=zt,eu++):(c=_r,0===iu&&s(Zt)),c!==_r?(a=Ar(),a!==_r?(i=D(),i!==_r?(o=[o,c,a,i],u=o):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(uu=t,n=ve(n,e),t=n):(eu=t,t=_r)}else eu=t,t=_r;return t}function ir(){var t,n,e,u,o,c,a,i,f,h;return t=eu,n=w(),n!==_r?(e=Ar(),e!==_r?(u=pr(),u!==_r?(o=Ar(),o!==_r?(40===r.charCodeAt(eu)?(c=Gr,eu++):(c=_r,0===iu&&s(Hr)),c!==_r?(a=Ar(),a!==_r?(i=ar(),i===_r&&(i=null),i!==_r?(f=Ar(),f!==_r?(41===r.charCodeAt(eu)?(h=Jr,eu++):(h=_r,0===iu&&s(Kr)),h!==_r?(uu=t,n=Ae(n,i),t=n):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r)):(eu=t,t=_r),t}function fr(){var r,t;return r=eu,t=lr(),t!==_r&&(uu=r,t=ge(t)),r=t,r===_r&&(r=eu,t=hr(),t!==_r&&(uu=r,t=Ce(t)),(r=t)===_r&&(r=eu,t=sr(),t!==_r&&(uu=r,t=be(t)),r=t)),r}function sr(){var t,n;return t=eu,r.substr(eu,4)===ye?(n=ye,eu+=4):(n=_r,0===iu&&s(me)),n!==_r&&(uu=t,n=xe()),t=n,t===_r&&(t=eu,r.substr(eu,5)===Fe?(n=Fe,eu+=5):(n=_r,0===iu&&s(Se)),n!==_r&&(uu=t,n=we()),t=n),t}function hr(){var t,n,e;if(t=eu,n=[],Ee.test(r.charAt(eu))?(e=r.charAt(eu),eu++):(e=_r,0===iu&&s(ze)),e!==_r)for(;e!==_r;)n.push(e),Ee.test(r.charAt(eu))?(e=r.charAt(eu),eu++):(e=_r,0===iu&&s(ze));else n=_r;return n!==_r&&(uu=t,n=Ze()),t=n}function lr(){var t,n,e,u,o;for(t=eu,n=[],Ee.test(r.charAt(eu))?(e=r.charAt(eu),eu++):(e=_r,0===iu&&s(ze));e!==_r;)n.push(e),Ee.test(r.charAt(eu))?(e=r.charAt(eu),eu++):(e=_r,0===iu&&s(ze));if(n!==_r)if(46===r.charCodeAt(eu)?(e=Re,eu++):(e=_r,0===iu&&s(_e)),e!==_r){for(u=[],Ee.test(r.charAt(eu))?(o=r.charAt(eu),eu++):(o=_r,0===iu&&s(ze));o!==_r;)u.push(o),Ee.test(r.charAt(eu))?(o=r.charAt(eu),eu++):(o=_r,0===iu&&s(ze));u!==_r?(uu=t,n=je(),t=n):(eu=t,t=_r)}else eu=t,t=_r;else eu=t,t=_r;return t}function pr(){var t,n,e,u,o;for(t=[],n=eu,37===r.charCodeAt(eu)?(e=ke,eu++):(e=_r,0===iu&&s(Me)),e!==_r?(u=vr(),u!==_r?(37===r.charCodeAt(eu)?(o=ke,eu++):(o=_r,0===iu&&s(Me)),o!==_r?(e=[e,u,o],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r);n!==_r;)t.push(n),n=eu,37===r.charCodeAt(eu)?(e=ke,eu++):(e=_r,0===iu&&s(Me)),e!==_r?(u=vr(),u!==_r?(37===r.charCodeAt(eu)?(o=ke,eu++):(o=_r,0===iu&&s(Me)),o!==_r?(e=[e,u,o],n=e):(eu=n,n=_r)):(eu=n,n=_r)):(eu=n,n=_r);return t}function dr(){var t,n,e,u,o,c;if(iu++,t=eu,n=eu,e=eu,qe.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(Be)),u!==_r){for(o=[],Ie.test(r.charAt(eu))?(c=r.charAt(eu),eu++):(c=_r,0===iu&&s(Ne));c!==_r;)o.push(c),Ie.test(r.charAt(eu))?(c=r.charAt(eu),eu++):(c=_r,0===iu&&s(Ne));o!==_r?(u=[u,o],e=u):(eu=e,e=_r)}else eu=e,e=_r;return n=e!==_r?r.substring(n,eu):e,n!==_r?(uu=eu,e=Oe(n),e=e?void 0:_r,e!==_r?(uu=t,n=Ue(n),t=n):(eu=t,t=_r)):(eu=t,t=_r),iu--,t===_r&&(n=_r,0===iu&&s(Te)),t}function vr(){var t,n,e,u;if(t=eu,34===r.charCodeAt(eu)?(n=De,eu++):(n=_r,0===iu&&s(Ge)),n!==_r){for(e=[],He.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(Je));u!==_r;)e.push(u),He.test(r.charAt(eu))?(u=r.charAt(eu),eu++):(u=_r,0===iu&&s(Je));e!==_r?(34===r.charCodeAt(eu)?(u=De,eu++):(u=_r,0===iu&&s(Ge)),u!==_r?(n=[n,e,u],t=n):(eu=t,t=_r)):(eu=t,t=_r)}else eu=t,t=_r;return t}function Ar(){var r,t;for(iu++,r=[],t=gr(),t===_r&&(t=Cr())===_r&&(t=br())===_r&&(t=yr());t!==_r;)r.push(t),(t=gr())===_r&&(t=Cr())===_r&&(t=br())===_r&&(t=yr());return iu--,r===_r&&(t=_r,0===iu&&s(Ke)),r}function gr(){var t;return Le.test(r.charAt(eu))?(t=r.charAt(eu),eu++):(t=_r,0===iu&&s(Pe)),t}function Cr(){var t;return Qe.test(r.charAt(eu))?(t=r.charAt(eu),eu++):(t=_r,0===iu&&s(Ve)),t}function br(){var t,n,e,u,o,c;if(t=eu,r.substr(eu,2)===We?(n=We,eu+=2):(n=_r,0===iu&&s(Xe)),n!==_r){for(e=[],u=eu,o=eu,iu++,r.substr(eu,2)===Ye?(c=Ye,eu+=2):(c=_r,0===iu&&s($e)),iu--,c===_r?o=void 0:(eu=o,o=_r),o!==_r?(c=mr(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=eu,iu++,r.substr(eu,2)===Ye?(c=Ye,eu+=2):(c=_r,0===iu&&s($e)),iu--,c===_r?o=void 0:(eu=o,o=_r),o!==_r?(c=mr(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(r.substr(eu,2)===Ye?(u=Ye,eu+=2):(u=_r,0===iu&&s($e)),u!==_r?(n=[n,e,u],t=n):(eu=t,t=_r)):(eu=t,t=_r)}else eu=t,t=_r;return t}function yr(){var t,n,e,u,o,c;if(t=eu,r.substr(eu,2)===ru?(n=ru,eu+=2):(n=_r,0===iu&&s(tu)),n!==_r){for(e=[],u=eu,o=eu,iu++,c=Cr(),iu--,c===_r?o=void 0:(eu=o,o=_r),o!==_r?(c=mr(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r);u!==_r;)e.push(u),u=eu,o=eu,iu++,c=Cr(),iu--,c===_r?o=void 0:(eu=o,o=_r),o!==_r?(c=mr(),c!==_r?(o=[o,c],u=o):(eu=u,u=_r)):(eu=u,u=_r);e!==_r?(n=[n,e],t=n):(eu=t,t=_r)}else eu=t,t=_r;return t}function mr(){var t;return r.length>eu?(t=r.charAt(eu),eu++):(t=_r,0===iu&&s(nu)),t}function xr(r,t){return{type:"var",name:t,location:r,toString:function(){return t}}}function Fr(r,t){return{type:"const",value:t,location:r,toString:function(){return t}}}function Sr(r,t,n,e){return{type:"op",op:t,operands:[n,e],location:r,toString:function(){return n+" "+t+" "+e}}}function wr(r,t,n){return{type:"op",op:t,operands:[n],location:r,toString:function(){return t+" "+n}}}function Er(r,t,n,e){return{type:"op",op:"?:",operands:[t,n,e],location:r,toString:function(){return"if "+t+" then "+n+" else "+e}}}function zr(r,t){return{type:"op",op:"list",operands:t,location:r,toString:function(){return"("+t.join(", ")+")"}}}function Zr(r,t,n){return{type:"op",op:"call",name:t,operands:n,location:r,toString:function(){return t+"("+n.join(", ")+")"}}}n=void 0!==n?n:{};var Rr,_r={},jr={Nodes:l},kr=l,Mr=function(r){for(var t={consts:{},nodes:{},types:{}},n=0;n<r.length;n++)if(r[n][0].constant)for(var e=0;e<r[n][0].constant.length;e++)t.consts[r[n][0].constant[e].name]=r[n][0].constant[e];else if(r[n][0].node)t.nodes[r[n][0].node.header.name]=r[n][0].node;else if(r[n][0].type)for(var e=0;e<r[n][0].type.length;e++)t.types[r[n][0].type[e].name]=r[n][0].type[e];return t},Tr=function(r){return{constant:r}},qr=function(r){return{node:r}},Br=function(r){return{type:r}},Ir=function(r,t){return{header:r,body:t}},Nr="node",Or=o("node",!1),Ur="function",Dr=o("function",!1),Gr="(",Hr=o("(",!1),Jr=")",Kr=o(")",!1),Lr="returns",Pr=o("returns",!1),Qr=";",Vr=o(";",!1),Wr=function(r,t,n,e){return{type:r,name:t,params:null==n?[]:n,returns:null==e?[]:e}},Xr=function(r,t){for(var n=[],e=0;e<r.length;e++)n.push(r[e]);for(var u=0;u<t.length;u++)for(var e=0;e<t[u][3].length;e++)n.push(t[u][3][e]);return n},Yr=":",$r=o(":",!1),rt=function(r,t,n){for(var e=[],u=0;u<r.length;u++)e.push({name:r[u],type:t,clock:null!=n?n[1]:null});return e},tt="when",nt=o("when",!1),et=function(r){return r},ut=function(r){return r},ot="let",ct=o("let",!1),at="tel",it=o("tel",!1),ft=function(r,t){for(var n=[],e=0;e<r.length;e++)for(var u=0;u<r[e][0].length;u++)n.push(r[e][0][u]);return{locals:n,equations:t}},st=function(r){return r},ht=function(r){return r},lt="var",pt=o("var",!1),dt=function(r){return r},vt="const",At=o("const",!1),gt=function(r){return r},Ct="=",bt=o("=",!1),yt=function(r,t,n){return{name:r,type:null!=t?t[2]:null,value:n}},mt="::",xt=o("::",!1),Ft=function(r,t){return r+"::"+t},St=function(r){return r},wt=function(r){return r},Et=function(r){return r},zt=",",Zt=o(",",!1),Rt="enum",_t=o("enum",!1),jt="{",kt=o("{",!1),Mt="}",Tt=o("}",!1),qt=function(r){return{values:r}},Bt=function(r){for(var t=[],n=0;n<r.length;n++)for(var e=0;e<r[n][0].length;e++)t.push(r[n][0][e]);return t},It=function(r,t){for(var n=[],e=0;e<r.length;e++)n.push({name:r[e],type:t});return n},Nt=function(r,t){return[{name:r,value:t}]},Ot=function(r,t,n){return[{name:r,type:t,value:n}]},Ut=function(r,t){for(var n=[r],e=0;e<t.length;e++)n.push(t[e][3]);return n},Dt="type",Gt=o("type",!1),Ht=function(r){for(var t=[],n=0;n<r.length;n++)t.push(r[n][0]);return t},Jt=function(r,t){return{name:r,type:t}},Kt=function(r,t){for(var n=[r],e=0;e<t.length;e++)n.push(t[e][1]);return n},Lt=function(r){return r},Pt=function(r){return r},Qt=function(r,t){return{left:r,right:t}},Vt=function(r){return r},Wt=function(r,t){for(var n=[r],e=0;e<t.length;e++)n.push(t[e][3]);return n},Xt=function(r){return xr(u(),r)},Yt="assert",$t=o("assert",!1),rn=function(r){return{assert:r}},tn="->",nn=o("->",!1),en="fby",un=o("fby",!1),on=/^[^a-zA-Z0-9_]/,cn=c([["a","z"],["A","Z"],["0","9"],"_"],!0,!1),an=function(){return"fby"},fn=function(r,t){return null!=t?Sr(u(),t[1],r,t[3]):r},sn="=>",hn=o("=>",!1),ln="or",pn=o("or",!1),dn=function(){return"or"},vn="xor",An=o("xor",!1),gn=function(){return"xor"},Cn="and",bn=o("and",!1),yn=function(){return"and"},mn="<=",xn=o("<=",!1),Fn="<>",Sn=o("<>",!1),wn="<",En=o("<",!1),zn=">=",Zn=o(">=",!1),Rn=">",_n=o(">",!1),jn="not",kn=o("not",!1),Mn=function(){return"not"},Tn=function(r,t){return wr(u(),r,t)},qn="+",Bn=o("+",!1),In="-",Nn=o("-",!1),On=function(r,t){for(var n=r;t.length>0;){var e=t.shift();n=Sr(u(),e[1],n,e[3])}return n},Un="*",Dn=o("*",!1),Gn="/",Hn=o("/",!1),Jn="mod",Kn=o("mod",!1),Ln=function(){return"mod"},Pn="div",Qn=o("div",!1),Vn=function(){return"div"},Wn="current",Xn=o("current",!1),Yn=function(){return"current"},$n="pre",re=o("pre",!1),te=function(){return"pre"},ne="#",ee=o("#",!1),ue=function(r){return r},oe=function(r){return Fr(u(),r)},ce=function(r){return r},ae=function(r){return 1==r.length?r[0]:zr(u(),r)},ie="if",fe=o("if",!1),se="then",he=o("then",!1),le="else",pe=o("else",!1),de=function(r,t,n){return Er(u(),r,t,n)},ve=function(r,t){for(var n=[r],e=0;e<t.length;e++)n.push(t[e][3]);return n},Ae=function(r,t){return Zr(u(),r,null==t?[]:t)},ge=function(r){return r},Ce=function(r){return r},be=function(r){return r},ye="true",me=o("true",!1),xe=function(){return!0},Fe="false",Se=o("false",!1),we=function(){return!1},Ee=/^[0-9]/,ze=c([["0","9"]],!1,!1),Ze=function(){return parseInt(e())},Re=".",_e=o(".",!1),je=function(){return parseFloat(e())},ke="%",Me=o("%",!1),Te=a("identifier"),qe=/^[a-zA-Z]/,Be=c([["a","z"],["A","Z"]],!1,!1),Ie=/^[a-zA-Z0-9_]/,Ne=c([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),Oe=function(r){return-1===fu.indexOf(r)},Ue=function(r){return r},De='"',Ge=o('"',!1),He=/^[^"]/,Je=c(['"'],!0,!1),Ke=a("whitespace"),Le=/^[\t\x0B\f \xA0\uFEFF]/,Pe=c(["\t","\v","\f"," "," ","\ufeff"],!1,!1),Qe=/^[\n\r]/,Ve=c(["\n","\r"],!1,!1),We="/*",Xe=o("/*",!1),Ye="*/",$e=o("*/",!1),ru="--",tu=o("--",!1),nu=function(){return{type:"any"}}(),eu=0,uu=0,ou=[{line:1,column:1}],cu=0,au=[],iu=0;if("startRule"in n){if(!(n.startRule in jr))throw new Error("Can't start parsing from rule \""+n.startRule+'".');kr=jr[n.startRule]}var fu=["node","function","const","returns","assert","if","then","else","when","current","fby","let","tel","or","xor","and","not","mod","div"];if((Rr=kr())!==_r&&eu===r.length)return Rr;throw Rr!==_r&&eu<r.length&&s(function(){return{type:"end"}}()),h(au,cu<r.length?r.charAt(cu):null,cu<r.length?f(cu,cu+1):f(cu,cu))}!function(r,t){function n(){this.constructor=r}n.prototype=t.prototype,r.prototype=new n}(t,Error),t.buildMessage=function(r,t){function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function e(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+n(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+n(r)})}function u(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+n(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+n(r)})}function o(r){return c[r.type](r)}var c={literal:function(r){return'"'+e(r.text)+'"'},class:function(r){var t,n="";for(t=0;t<r.parts.length;t++)n+=r.parts[t]instanceof Array?u(r.parts[t][0])+"-"+u(r.parts[t][1]):u(r.parts[t]);return"["+(r.inverted?"^":"")+n+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};return"Expected "+function(r){var t,n,e=new Array(r.length);for(t=0;t<r.length;t++)e[t]=o(r[t]);if(e.sort(),e.length>0){for(t=1,n=1;t<e.length;t++)e[t-1]!==e[t]&&(e[n]=e[t],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(r)+" but "+function(r){return r?'"'+e(r)+'"':"end of input"}(t)+" found."},r.lusparser={SyntaxError:t,parse:n}}(this);</script> <script>!function(r){"use strict";function e(r){if(Array.isArray(r)){for(var n=[],t=0;t<r.length;t++)for(var o=e(r[t]),a=0;a<o.length;a++)-1===n.indexOf(o[a])&&n.push(o[a]);return n}if("const"==r.type)return[];if("var"==r.type)return[r.name];if("op"==r.type)return"pre"==r.op?[]:e("fby"==r.op?r.operands[0]:r.operands);throw new s("VariableCollectionError","Unknown type: "+r.type,r.location)}function n(r,e){for(var n=r.nodes[e],t={},o=0;o<n.header.params.length;o++)t[n.header.params[o].name]=n.header.params[o].clock;for(var a in r.consts)t[a]=null;for(var o=0;o<n.header.returns.length;o++)t[n.header.returns[o].name]=n.header.returns[o].clock;for(var o=0;o<n.body.locals.length;o++)t[n.body.locals[o].name]=n.body.locals[o].clock;return t}function t(r,e,n,o){if("op"==e.type){"pre"==e.op?o[e.toString()]=a(r,e.operands[0],n,o):"fby"==e.op?o[e.toString()]=a(r,e.operands[1],n,o):"->"==e.op&&(o[e.toString()]=!0);for(var i=0;i<e.operands.length;i++)t(r,e.operands[i],n,o)}}function o(r,e,n){if(r.length!=e)throw new s("EvaluationError","Illegal number of arguments when evaluating '"+n+"': Expected "+e+", got "+r.length,n.location)}function a(r,e,n,t){if("const"==e.type)return[e.value];if("var"==e.type){if(!(e.name in n))throw new s("ExecutionError","Variable '"+e.name+"' is not declared.",e.location);return[n[e.name]]}if("op"==e.type){if("when"==e.op){var l=a(r,e.operands[1],n,t);return o(l,1,e),l[0]?(t[e.toString()]=!0,a(r,e.operands[0],n,t)):(t[e.toString()]=!1,[null])}if("pre"==e.op){var c=e.toString();return t[c]}if("fby"==e.op){var c=e.toString();return c in t?t[c]:a(r,e.operands[0],n,t)}if("->"==e.op){var c=e.toString();return c in t?a(r,e.operands[1],n,t):a(r,e.operands[0],n,t)}for(var u=[],h=[],f=0;f<e.operands.length;f++){var p=a(r,e.operands[f],n,t);if(p)for(var g=0;g<p.length;g++)h.push(p[g]);u.push(p)}switch(e.op){case"list":return h;case"call":var c=e.toString();c in t||(t[c]={});try{return i(r,e.name,h,t[c])}catch(r){throw r.location||(r.location=e.location),r}case"?:":return o(u,3,e),o(u[0],1,e),h[0]?u[1]:u[2];case"=>":return o(h,2,e),[!h[0]||h[1]];case"or":return o(h,2,e),[h[0]||h[1]];case"xor":return o(h,2,e),[h[0]?!h[1]:h[1]];case"and":return o(h,2,e),[h[0]&&h[1]];case"<":return o(h,2,e),[h[0]<h[1]];case"<=":return o(h,2,e),[h[0]<=h[1]];case"=":return o(h,2,e),[h[0]==h[1]];case">=":return o(h,2,e),[h[0]>=h[1]];case">":return o(h,2,e),[h[0]>h[1]];case"<>":return o(h,2,e),[h[0]!=h[1]];case"not":return o(h,1,e),[!h[0]];case"+":return o(h,2,e),[h[0]+h[1]];case"-":if(1==h.length)return[-h[0]];if(2==h.length)return[h[0]-h[1]];o(h,2,e);case"*":return o(h,2,e),[h[0]*h[1]];case"/":return o(h,2,e),[h[0]/h[1]];case"mod":return o(h,2,e),[h[0]%h[1]];case"div":return o(h,2,e),[Math.floor(h[0]/h[1])];case"current":return o(u,1,e),null!=h[0]&&(t[c]=u[0]),t[c];case"#":for(var d=0,f=0;f<h.length;f++)h[f]&&d++;return[d<=1]}throw new s("EvaluationError","Unknown operation: "+e.op,e.location)}throw new s("EvaluationError","Unknown expression type: "+e.type,e.location)}function i(r,o,i,l){var c=r.nodes[o];if(!c)throw new s("ExecutionError","Node '"+o+"' is not defined.");var u=n(r,o),h={};for(var f in r.consts)h[f]=a(r,r.consts[f].value,{},{})[0];if(i.length!=c.header.params.length)throw new s("ExecutionError","Illegal argument count for '"+o+"': Expected "+c.header.params.length+", got "+i.length+".");for(var p=0;p<c.header.params.length;p++)h[c.header.params[p].name]=i[p];for(var g=!0,d=[null];d.length>0&&g;){g=!1,d=[];for(var p=0;p<c.body.equations.length;p++){var v=c.body.equations[p];if(!v.assert){var w=e(v.left),E=u[w[0]];if(!(w[0]in h)){for(var y=!0,m=0;m<w.length;m++)if(d.push(w[m]),null==E||E in h||(y=!1),!(w[m]in u))throw new s("ExecutionError","Variable '"+w[m]+"' is not declared.",v.left[m].location);for(var x=e(v.right),m=0;m<x.length;m++)if(x[m]in h||(y=!1),!(x[m]in u))throw new s("ExecutionError","Variable '"+x[m]+"' is not declared.",v.right.location);if(y)if(null==E||h[E]){var b=a(r,v.right,h,l);if(void 0===b)throw new s("ExecutionError","Result of '"+v.right+"' is not defined.",v.right.location);if(b.length!=w.length)throw new s("ExecutionError","Incorrect result count in assignment of '"+w.join("', '")+"': Expected "+w.length+", got "+b.length+".",v.right.location);for(var m=0;m<w.length;m++){if(void 0===b[m])throw new s("ExecutionError","Result of '"+v.right+"' is not defined.",v.right.location);h[w[m]]=b[m]}g=!0}else{for(var m=0;m<w.length;m++)h[w[m]]=null;g=!0}}}}}if(d.length>0)throw new s("ExecutionError","Cannot calculate node '"+o+"', circular reference in the definition of '"+d.join("', '")+"'");for(var p=0;p<c.body.equations.length;p++){var v=c.body.equations[p];if(v.assert){if(!a(r,v.assert,h,l))throw new s("AssertionError","Assertion failed: "+v.assert.toString(),v.assert.location)}else if(v.right){var E=u[e(v.left)[0]];(null==E||e[E])&&t(r,v.right,h,l)}}for(var b=[],p=0;p<c.header.returns.length;p++)b.push(h[c.header.returns[p].name]);return l._vars=h,b}function s(r,e,n){this.name=r,this.message=e,this.location=n,"captureStackTrace"in Error?Error.captureStackTrace(this,s):this.stack=(new Error).stack}s.prototype=Object.create(Error.prototype),s.prototype.name="ExeutionError",s.prototype.constructor=s,r.lusexecutor={step:i}}(this);</script> <script>function highlightError(){errorLocation&&_code.setSelectionRange(errorLocation.start.offset,errorLocation.end.offset)}function updateCode(){try{app=lusparser.parse(_code.value),_error.innerText="",errorLocation=null,_code.className=""}catch(e){app={nodes:{}},_error.innerText=e.name+": "+e.message,e.location&&(_code.className="error",errorLocation=e.location,_error.innerText+="\nLocation: Line "+e.location.start.line+", column "+e.location.start.column)}updateNodes()}function updateNodes(){for(;_node.firstChild;)_node.removeChild(_node.firstChild);for(var e in app.nodes){var t=document.createElement("option");t.value=e,t.appendChild(document.createTextNode(e)),_node.appendChild(t),e==lastNode&&(_node.value=e)}updateNode()}function inputUi(e){var t=inputs.length;switch(e){case"int":var n=document.createElement("input");return n.type="number",n.step="1",n.value=0,inputs.push(0),n.addEventListener("change",function(e){inputs[t]=parseInt(n.value)}),n;case"float":var n=document.createElement("input");return n.type="number",n.step="any",n.value=0,inputs.push(0),n.addEventListener("change",function(e){inputs[t]=parseFloat(n.value)}),n;case"bool":var n=document.createElement("input");return n.type="checkbox",n.checked=!1,inputs.push(!1),n.addEventListener("change",function(e){inputs[t]=n.checked}),n}}function updateNode(){for(var e=app.nodes[_node.value];_results.firstChild;)_results.removeChild(_results.firstChild);if(state={},null!=e){lastNode=_node.value,_inputrow=document.createElement("tr");var t=document.createElement("tr"),n=document.createElement("tr"),a=e.header.params,o=e.header.returns,r=e.body.locals;if(inputs=[],a.length>0){var d=document.createElement("th");d.appendChild(document.createTextNode("Inputs")),d.colSpan=a.length,d.className="header",t.appendChild(d)}for(var l=0;l<a.length;l++){var d=document.createElement("th");d.appendChild(document.createTextNode(a[l].name)),n.appendChild(d);var c=document.createElement("td");c.appendChild(inputUi(a[l].type)),_inputrow.appendChild(c)}if(o.length>0){var d=document.createElement("th");d.appendChild(document.createTextNode("Results")),d.colSpan=o.length,d.className="header",t.appendChild(d)}for(var l=0;l<o.length;l++){var d=document.createElement("th");d.appendChild(document.createTextNode(o[l].name)),n.appendChild(d),_inputrow.appendChild(document.createElement("td"))}if(r.length>0){var d=document.createElement("th");d.appendChild(document.createTextNode("Variables")),d.colSpan=r.length,d.className="header local",t.appendChild(d)}for(var l=0;l<r.length;l++){var d=document.createElement("th");d.appendChild(document.createTextNode(r[l].name)),n.appendChild(d),d.className="local",_inputrow.appendChild(document.createElement("td"))}_results.appendChild(t),_results.appendChild(n),_results.appendChild(_inputrow)}}function stepNode(){if(app.nodes[_node.value]){try{var e=lusexecutor.step(app,_node.value,inputs,state);_code.className=""}catch(e){return _error.innerText=e.name+": "+e.message,void(e.location&&(errorLocation=e.location,_error.innerText+="\nLocation: Line "+e.location.start.line+", column "+e.location.start.column,_code.className="error"))}for(var t=app.nodes[_node.value],n=t.header.params,a=t.header.returns,o=t.body.locals,r=document.createElement("tr"),d=0;d<n.length;d++){var l=document.createElement("td");l.appendChild(document.createTextNode(inputs[d])),l.className="val"+inputs[d],r.appendChild(l)}for(var d=0;d<a.length;d++){var l=document.createElement("td");l.appendChild(document.createTextNode(e[d])),l.className="val"+e[d],r.appendChild(l)}for(var d=0;d<o.length;d++){var l=document.createElement("td"),c=state._vars[o[d].name];l.appendChild(document.createTextNode(c)),l.className="local val"+c,r.appendChild(l)}_results.insertBefore(r,_inputrow.nextSibling),console.log("Executing step for "+_node.value),logState(_node.value,state)}}function logState(e,t){var n={_:e};for(var a in t._vars)n[a]=t._vars[a];console.log(n);for(var o in t)t[o]._vars&&logState(e+"."+o,t[o])}function resetNode(){updateNode()}function autostepNode(){_autostep.checked&&stepNode()}var _code=document.getElementById("code"),_node=document.getElementById("node"),_results=document.getElementById("results"),_step=document.getElementById("stepNode"),_error=document.getElementById("error"),_reset=document.getElementById("resetNode"),_autostep=document.getElementById("autostep"),_inputrow=null,inputs=[],app=null,state={},errorLocation=null,lastNode=null;_code.addEventListener("change",updateCode),_code.addEventListener("focus",highlightError),_node.addEventListener("change",updateNode),_step.addEventListener("click",stepNode),_reset.addEventListener("click",resetNode),updateCode(),setInterval(autostepNode,1e3);</script> </body> </html>
